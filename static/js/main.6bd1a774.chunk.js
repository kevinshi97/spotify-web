(this["webpackJsonpspotify-web"]=this["webpackJsonpspotify-web"]||[]).push([[0],{233:function(t,e,a){t.exports=a(454)},238:function(t,e,a){},239:function(t,e,a){},451:function(t,e,a){},452:function(t,e,a){},454:function(t,e,a){"use strict";a.r(e);var r=a(1),s=a.n(r),o=a(71),n=a.n(o),i=(a(238),a(12)),c=a(13),u=a(35),l=a(34),h=(a(239),a(193)),d=a(205),p=function(){function t(){Object(i.a)(this,t),this.client_id="287daee6bafd4ce48e000a00a40d3f6f",this.redirect_uri="http://kevinshi97.github.io/spotify-web",this.scopes="user-top-read user-follow-read user-library-read",this.state=this.generateRandomString(16),this.auth_url="https://accounts.spotify.com/authorize?response_type=token&client_id="+encodeURIComponent(this.client_id)+"&redirect_uri="+encodeURIComponent(this.redirect_uri)+"&state="+encodeURIComponent(this.state)+"&scope="+encodeURIComponent(this.scopes),this.access_token=null,this.token_type=null,this.expires_in=null,this.returned_state=null,this.stored_state=null;var e=new URLSearchParams(window.location.hash.replace("#","?"));this.access_token=e.get("access_token"),this.token_type=e.get("token_type"),this.expires_in=e.get("expires_in"),this.returned_state=e.get("state"),this.stored_state=localStorage.getItem("spotify_auth_state")}return Object(c.a)(t,[{key:"logIn",value:function(){localStorage.setItem("spotify_auth_state",this.state),window.location.href=this.auth_url}},{key:"generateRandomString",value:function(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}},{key:"isLoggedIn",get:function(){return this.access_token&&this.stored_state===this.returned_state||!1}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),t}();p._instance=void 0;var k,f=p.Instance;!function(t){t.short_term="short_term",t.medium_term="medium_term",t.long_term="long_term"}(k||(k={}));var m=function(){function t(e){Object(i.a)(this,t),this.access_token=null,this.token_type=null,this.expires_in=null,this.returned_state=null,this.stored_state=null,this.app=void 0,this.app=e,this.access_token=f.access_token,this.token_type=f.token_type,this.expires_in=f.expires_in,this.returned_state=f.returned_state,this.stored_state=f.stored_state}return Object(c.a)(t,[{key:"logIn",value:function(){f.logIn()}},{key:"getTopTracks",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.medium_term;if(e<1||e>50||a<0||a>e)console.log("invalid params");else{var s="https://api.spotify.com/v1/me/top/tracks?&limit="+encodeURIComponent(e)+"&offset="+encodeURIComponent(a)+"&time_range="+encodeURIComponent(r),o={headers:{Authorization:"Bearer "+this.access_token},method:"GET"};fetch(s,o).then((function(t){return t.json()})).then((function(e){var a=e.items;t.app.setState({tracks:a,curr_track:a[0]||null}),console.log(t.app.state.tracks),console.log(t.app.state.curr_track)}))}}},{key:"getAudioFeature",value:function(t){var e=this,a=t.uri.split(":").pop()||"";console.log(a);var r="https://api.spotify.com/v1/audio-features/"+encodeURI(a),s={headers:{Authorization:"Bearer "+this.access_token},method:"GET"};fetch(r,s).then((function(t){return t.json()})).then((function(t){var a=t;console.log(a),e.app.setState({curr_audio_features:a})}))}},{key:"isLoggedIn",get:function(){return f.isLoggedIn}}]),t}(),_=a(194),g=a.n(_),v=a(19),y={background:"#89CFF0",border:"#187795",highlight:{background:"#002387",border:"#318CE7"}},b={color:"#ffffff"},E={color:"#ffffff",highlight:"#97EFE9"},w={background:"#002387",border:"#318CE7",highlight:{background:"#89CFF0",border:"#187795"}},I={color:"#000000"},C={color:"#000000",highlight:"#97EFE9"},S=(a(451),function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var r;return Object(i.a)(this,a),(r=e.call(this,t)).state={dark:r.props.dark,audio_features:r.props.audio_features,track:r.props.track},r}return Object(c.a)(a,[{key:"render",value:function(){var t,e=this.state.dark?"#89CFF0":"#002387";return s.a.createElement("div",{className:"info-container"},s.a.createElement("div",{className:"song-container"},s.a.createElement("img",{src:this.state.image,className:"album-logo",alt:"logo"}),s.a.createElement("a",{className:"title App-link",href:this.state.url,target:"_blank",rel:"noopener noreferrer"},this.state.name)),s.a.createElement("div",{className:"chart-container"},s.a.createElement(v.f,null,s.a.createElement(v.e,{data:this.state.data},s.a.createElement(v.b,null),s.a.createElement(v.a,{dataKey:"feature"}),s.a.createElement(v.c,{angle:18,domain:[0,1],tick:!1}),s.a.createElement(v.d,{name:this.props.track?this.props.track.name:"",dataKey:"A",stroke:e,fill:e,fillOpacity:.6}),s.a.createElement(v.g,{scaleToFit:!0})))),s.a.createElement("div",{className:"player-container"},s.a.createElement("iframe",{id:"player",src:null===(t=this.state.track)||void 0===t?void 0:t.preview_url,allowTransparency:!0,allow:"encryted-media"})))}},{key:"componentDidMount",value:function(){this.props.track&&(this.props.track.external_urls&&this.props.track.name&&this.setState({name:this.props.track.name,url:this.props.track.external_urls.spotify||"#",track:this.props.track}),this.props.track.album.images&&this.setState({image:this.props.track.album.images[0].url})),this.props.audio_features&&this.updateChartArea()}},{key:"componentDidUpdate",value:function(t,e){this.props.track&&this.props.track!==t.track&&(this.props.track.external_urls&&this.props.track.name&&this.setState({name:this.props.track.name,url:this.props.track.external_urls.spotify||"#",track:this.props.track}),this.props.track.album.images&&this.setState({image:this.props.track.album.images[0].url})),this.props.dark&&this.props.dark!=t.dark&&this.setState({dark:this.props.dark}),this.props.audio_features&&this.props.audio_features!==t.audio_features&&this.updateChartArea()}},{key:"updateChartArea",value:function(){var t,e,a,r,s,o=this,n=(null===(t=this.props.audio_features)||void 0===t?void 0:t.tempo)||0,i=[{feature:"valence",A:null===(e=this.props.audio_features)||void 0===e?void 0:e.valence,fullMark:1},{feature:"danceability",A:null===(a=this.props.audio_features)||void 0===a?void 0:a.danceability,fullMark:1},{feature:"energy",A:null===(r=this.props.audio_features)||void 0===r?void 0:r.danceability,fullMark:1},{feature:"acousticness",A:null===(s=this.props.audio_features)||void 0===s?void 0:s.acousticness,fullMark:1},{feature:"tempo",A:n/250,fullMark:1}];this.setState({data:i},(function(){console.log("here"),console.log(o.state.data)}))}}]),a}(r.Component)),j=(a(452),function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var r;Object(i.a)(this,a);var s=[],o=[];if(t.tracks)for(var n=0;n<t.tracks.length;n++)s.push({id:n+1,label:t.tracks[n].name,title:t.tracks[n].name,shape:"dot",color:y,font:b}),n>1&&o.push({to:n-1,from:n,color:E});return(r=e.call(this,t)).state={dark:r.props.dark,nodes:s,edges:o,curr_track:r.props.curr_track,curr_audio_features:r.props.curr_audio_features,tracks:r.props.tracks},r}return Object(c.a)(a,[{key:"_updateCurrTrack",value:function(t){console.log(t);var e=t[0]-1;this.setState({curr_track:this.state.tracks?this.state.tracks[e]:this.state.curr_track})}},{key:"render",value:function(){var t=this;return s.a.createElement("div",{className:"main-container"},s.a.createElement("div",{className:"graph-container"},s.a.createElement(g.a,{graph:{nodes:this.state.nodes,edges:this.state.edges},options:{layout:{improvedLayout:!0,hierarchical:!1},edges:{color:"#000000"},interaction:{zoomView:!0},width:"100%",height:"100%"},events:{selectNode:function(e){var a=e.nodes;e.edges;t._updateCurrTrack(a)}},getNetwork:function(e){t.setState({network:e})}})),s.a.createElement(S,{audio_features:this.state.curr_audio_features,track:this.state.curr_track,dark:this.state.dark}))}},{key:"componentDidUpdate",value:function(t,e){var a=this;(console.log("graph updated"),this.state.tracks&&this.state.curr_track!==e.curr_track)&&new m(this).getAudioFeature(this.state.curr_track);if(this.state.network&&(console.log("im in the network"),this.state.dark!==this.props.dark)){for(var r=this.state.nodes,s=this.state.edges,o=0;o<r.length;o++)r[o].color=this.props.dark?y:w,r[o].font=this.props.dark?b:I;for(var n=0;n<s.length;n++)s[n].color=this.props.dark?E:C;this.setState({dark:this.props.dark,nodes:r,edges:s},(function(){var t,e;console.log(a.state),null===(t=a.state.network)||void 0===t||t.setData({nodes:a.state.nodes,edges:a.state.edges}),null===(e=a.state.network)||void 0===e||e.redraw()}))}}}]),a}(r.Component)),A=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var r;return Object(i.a)(this,a),(r=e.call(this,t)).changeTheme=function(){r.setState({dark:!r.state.dark})},r.state={loggedIn:!1,dark:!0,query_top_limit:50,query_top_offset:0,query_top_timerange:k.short_term},r}return Object(c.a)(a,[{key:"render",value:function(){var t;return t=this.state.tracks&&this.state.curr_audio_features?s.a.createElement(j,{dark:this.state.dark,curr_track:this.state.curr_track,curr_audio_features:this.state.curr_audio_features,tracks:this.state.tracks}):s.a.createElement("div",null),s.a.createElement("div",{className:"App"},s.a.createElement("div",{className:"App-main ".concat(this.state.dark?"dark":"")},s.a.createElement(h.a,{id:"dar-mode-btn",icon:d.a,onClick:this.changeTheme}),t))}},{key:"componentDidMount",value:function(){var t=new m(this);t.isLoggedIn?(this.setState({loggedIn:!0}),t.getTopTracks(this.state.query_top_limit,this.state.query_top_offset,this.state.query_top_timerange)):(console.log("not logged in"),t.logIn())}},{key:"componentDidUpdate",value:function(t,e){var a=new m(this);this.state.tracks&&this.state.curr_track!==e.curr_track&&a.getAudioFeature(this.state.curr_track)}}]),a}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(453);n.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[233,1,2]]]);
//# sourceMappingURL=main.6bd1a774.chunk.js.map